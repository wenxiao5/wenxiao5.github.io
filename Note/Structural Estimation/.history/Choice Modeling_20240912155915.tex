\documentclass[11pt]{elegantbook}
\usepackage{graphicx}
%\usepackage{float}
\definecolor{structurecolor}{RGB}{40,58,129}
\linespread{1.6}
\setlength{\footskip}{20pt}
\setlength{\parindent}{0pt}
\newcommand{\argmax}{\operatornamewithlimits{argmax}}
\newcommand{\argmin}{\operatornamewithlimits{argmin}}
\elegantnewtheorem{proof}{Proof}{}{Proof}
\elegantnewtheorem{claim}{Claim}{prostyle}{Claim}
\DeclareMathOperator{\col}{col}
\title{Structural Estimation}
\author{Wenxiao Yang}
\institute{Haas School of Business, University of California Berkeley}
\date{2024}
\setcounter{tocdepth}{2}
\extrainfo{All models are wrong, but some are useful.}

\cover{cover.png}

% modify the color in the middle of titlepage
\definecolor{customcolor}{RGB}{32,178,170}
\colorlet{coverlinecolor}{customcolor}
\usepackage{cprotect}


\bibliographystyle{apalike_three}

\begin{document}
\maketitle

\frontmatter
\tableofcontents

\mainmatter

\chapter{Homogenous Products}
How do we estimate demand for a homogenous product?
\section{\cite{working1927statistical}: OLS is not informative with endogeneity}
Demand and Supply for coffee:
\begin{equation}
    \begin{aligned}
        Q^d_t=\alpha_0+\alpha_1 P_t+U_t\\
        Q^s_t=\beta_0+\beta_1 P_t+V_t
    \end{aligned}
    \nonumber
\end{equation}
where $\alpha_1<0$ and $\beta_1>0$. Equilibrium price and quantity are given by
\begin{equation}
    \begin{aligned}
        Q^d_t=Q^s_t \Rightarrow \left\{\begin{matrix}
            P_t=\frac{\beta_0-\alpha_0}{\alpha_1-\beta_1}+\frac{V_t-U_t}{\alpha_1-\beta_1}\\
            Q_t=\frac{\alpha_1\beta_0-\alpha_0\beta_1}{\alpha_1-\beta_1}+\frac{\alpha_1V_t-\beta_1U_t}{\alpha_1-\beta_1}
        \end{matrix}\right.
    \end{aligned}
    \nonumber
\end{equation}
\begin{note}
    Price is a function of both error terms, and we can't use a clever substitution to cancel things out.
\end{note}
We can find that price is positively correlated with demand shift $U_t$ and negatively correlated with supply shift $V_t$.

Consider the OLS estimator: $\hat{\alpha}_1=\hat{\beta}_1=\frac{\textnormal{Cov}(P_t,Q_t)}{\textnormal{Var}(P_t)}$. Since we have
\begin{equation}
    \begin{aligned}
        \left.\begin{matrix}
            \textnormal{Cov}(P_t,Q_t)=\alpha_1\textnormal{Var}(P_t)+\textnormal{Cov}(P_t,U_t)\\
            \textnormal{Cov}(P_t,Q_t)=\beta_1\textnormal{Var}(P_t)+\textnormal{Cov}(P_t,V_t)
        \end{matrix}\right\} \Rightarrow \left\{\begin{matrix}
            \textnormal{Bias}(\alpha_1)=|\hat{\alpha}_1-\alpha_1|=\frac{\textnormal{Cov}(P_t,U_t)}{\textnormal{Var}(P_t)}\\
            \textnormal{Bias}(\beta_1)=|\hat{\beta}_1-\beta_1|=\frac{\textnormal{Cov}(P_t,V_t)}{\textnormal{Var}(P_t)}\\
        \end{matrix}\right.
    \end{aligned}
    \nonumber
\end{equation}
When $\textnormal{Cov}(U_t,V_t)=0$, the OLS estimator can be written as
\begin{equation}
    \begin{aligned}
        \hat{\alpha}_1=\hat{\beta}_1=\frac{\alpha_1\textnormal{Var}(V_t)+\beta_1\textnormal{Var}(U_t)}{\textnormal{Var}(V_t)+\textnormal{Var}(U_t)}
    \end{aligned}
    \nonumber
\end{equation}
More variation in supply $V_t$ gives a better estimate of demand and more variation in demand $U_t$ gives a better estimate of supply.

The OLS is not informative about the economic demand function (or supply function).

To deal with this problem, we need an excluded instrument that shifts one curve without affecting the other. Then, we can use this to form a 2SLS estimate.


\section{\cite{angrist2000interpretation}: IV is limited}
\subsection{Motivation}
What if we don't generality know which kind of heterogeneity we face?

There are four cases that are ranked in increasing complexity:
\begin{enumerate}
    \item Linear system with constant coefficients:
    \begin{equation}
        \begin{aligned}
            q^d_t(p,z,x)=\alpha_0+\alpha_1 p+\alpha_2 z+\alpha_3 x+\epsilon_t\\
            q^s_t(p,z,x)=\beta_0+\beta_1 p+\beta_2 z+\beta_3 x+\eta_t
        \end{aligned}
        \nonumber
    \end{equation}
    \item Linear system with non-constant coefficients:
    \begin{equation}
        \begin{aligned}
            q^d_t(p,z,x)=\alpha_{0t}+\alpha_{1t} p+\alpha_{2t} z+\alpha_{3t} x +\epsilon_t\\
            q^s_t(p,z,x)=\beta_{0t}+\beta_{1t} p+\beta_{2t} z+\beta_{3t} x +\eta_t
        \end{aligned}
        \nonumber
    \end{equation}
    \item Nonlinear system with constant shape (separable):
    \begin{equation}
        \begin{aligned}
            q^d_t(p,z,x)=q^d(p,z,x)+\epsilon_t\\
            q^s_t(p,z,x)=q^s(p,z,x)+\eta_t
        \end{aligned}
        \nonumber
    \end{equation}
    \item Nonlinear system with time-varying shape (non-separable): any forms of $q^d_t(p,z,x)$ and $q^s_t(p,z,x)$.
\end{enumerate}

\subsection{Model}
We assume the regularity conditions (existence of first and second moment and being stationary) and $q^d_t(p,z,x)$, $q^s_t(p,z,x)$ are continuously differentiable in $p$.

\paragraph*{Instrumental Variable}
Assume binary instrument $z_t\in\{0,1\}$ to make things easier. And $z_t\in\{0,1\}$ is a valid instrument in $q^d_t$, i.e., it satisfies
\begin{enumerate}
    \item Exclusion: $q^d_t(p_t,z=1,x_t)=q^d_t(p_t,z=0,x_t)=q^d_t(p_t,x_t)$.
    \item Relevance: $q^s_t(p_t,z=1,x_t)\neq q^s_t(p_t,z=0,x_t)$ for some period $t$.
    \item Independence: $\epsilon_t,\eta_t,z_t$ are mutually independent conditional on $x_t$.
\end{enumerate}

Suppose $z=1$ denote ``stormy at sea'' and $z=0$ denote ``calm at sea''. (Offshore weather makes fishing more difficult but doesn't change onshore demand.)

2SLS can work in linear models,
\begin{equation}
    \begin{aligned}
        \hat{\alpha}_{1,0}=\frac{\widehat{\mathbb{E}_t[q_t|z_t=1]}-\widehat{\mathbb{E}_t[q_t|z_t=0]}}{\widehat{\mathbb{E}_t[p_t|z_t=1]}-\widehat{\mathbb{E}_t[p_t|z_t=0]}}\stackrel{P}{\longrightarrow}\frac{\mathbb{E}_t[q_t|z_t=1]-\mathbb{E}_t[q_t|z_t=0]}{\mathbb{E}_t[p_t|z_t=1]-\mathbb{E}_t[p_t|z_t=0]}:= \alpha_{1,0}
    \end{aligned}
    \nonumber
\end{equation}
but it is not an estimator of a structural parameter in nonlinear models.

\begin{claim}
    Authors make the point that IV estimator identifies something about relationship between $p$ and $q$, without identifying deep structural parameters.
\end{claim}

Some assumptions are needed to interpret the IV estimator.
\begin{assumption}
    \begin{enumerate}
        \item Observed price is market clearing price $q^d_t(p_t)=q^s_t(p_t,z_t)$ for all $t$. (i.e., no friction).
        \item For each value of $z$ and $t$, there is a unique market clearing price, $\tilde{p}(z,t)$, such that
        \begin{equation}
            \begin{aligned}
                q^d_t(\tilde{p}(z,t))=q^s_t(\tilde{p}(z,t),z)
            \end{aligned}
            \nonumber
        \end{equation}
        $\tilde{p}(z,t)$ is the potential price under any counterfactual $(z,t)$.
        \item $\mathbb{E}_t[p_t|z_t=1]\neq\mathbb{E}_t[p_t|z_t=0]$
        \item $\tilde{p}(z,t)$ is weakly increasing in $z$.
    \end{enumerate}
\end{assumption}


\begin{lemma}
    The numerator of $\alpha_{1,0}$ can be given by
    \begin{equation}
        \begin{aligned}
            \mathbb{E}_t[q_t|z_t=1]-\mathbb{E}_t[q_t|z_t=0]=\mathbb{E}_t\left[\int_{\tilde{p}(0,t)}^{\tilde{p}(1,t)}\frac{\partial q^d_t(s)}{\partial s}ds\right]
        \end{aligned}
        \nonumber
    \end{equation}
\end{lemma}

\begin{theorem}
    Based on this lemma, the IV estimator equals to
    \begin{equation}
        \begin{aligned}
            \alpha_{1,0}&=\frac{\mathbb{E}_t\left[\int_{\tilde{p}(0,t)}^{\tilde{p}(1,t)}\frac{\partial q^d_t(s)}{\partial s}ds\right]}{\mathbb{E}_t\tilde{p}(1,t)-\mathbb{E}_t\tilde{p}(0,t)}\\
            &\rightarrow \int_0^\infty \mathbb{E}_t\left[\frac{\partial q^d_t(s)}{\partial s}\mid s\in[\tilde{p}(0,t),\tilde{p}(1,t)]\right]\omega(s)ds
        \end{aligned}
        \nonumber
    \end{equation}
    where $\omega(s)$ is the weight that is not a function of $t$, but it is largest for prices most likely to fall in $[\tilde{p}(0,t),\tilde{p}(1,t)]$.
\end{theorem}
\begin{note}
    \begin{enumerate}
        \item $\alpha_{1,0}$ only provides information about demand curve in range of potential price variation induced by the instrument.
        \item  For different instruments $z$, $\alpha_{1,0}$ has a different interpretation like the LATE does. (Different from the linear model where anything works!).
    \end{enumerate}
\end{note}




















\chapter{Random Utility Models}
Content is based on \cite{berry2021foundations}.
\section{Random Utility Models}
Let $j=1,...,J_i$ index the ``inside goods'' available to consumer $i$ while $j=0$ denotes the outside good. A consumer's choice set is characterized by $J_i$ and a set $\chi_i$, which may include
\begin{enumerate}[$\circ$]
    \item observed characteristics of consumer $i$,
    \item observed characteristics of goods (including prices),
    \item observed characteristics of the local market,
    \item and characteristics of the market or goods that are unobserved to the researcher.
\end{enumerate}
Each consumer $i$ has a (conditional indirect) utility $u_{ij}$ for good $j$. Consumer knows her utilities for all goods and chooses the good with the highest utility.

In this model, the heterogeneity of consumer preferences is modeled by random utilities:
\begin{definition}[Random Utility Model]
    Given the choice set $(J_i, \chi_i)$, each consumer's utility vector $(u_{ij})_{j=0,1,...,J_i}$ is an independent draw from a joint distribution $F_u(\cdot\mid J_i, \chi_i)$.
\end{definition}
Since only the ordinal ranking of goods matters for a consumer's behavior, we can normalize the location and scale of each consumer's utility vector without loss of generality. We assume that ``ties'' ($u_{ij}=u_{ik}$ for some $j\neq k$) occur with probability zero in the distribution $F_u(\cdot\mid J_i, \chi_i)$. Then, we can represent consumer $i$'s choice with the vector $(q_{i1},...,q_{iJ_i})$, where
\begin{equation}
    \begin{aligned}
        q_{ij}=\mathbf{1}\{u_{ij}\geq u_{ik},\forall k\}
    \end{aligned}
    \nonumber
\end{equation}
The consumer-specific choice probabilities are then given by
\begin{equation}
    \begin{aligned}
        s_{ij}:=\mathbb{E}[q_{ij}\mid J_i,\chi_i]=\int_{\mathcal{A}_{ij}}d F_u\left(u_{i0},...,u_{iJ_i}\mid J_i, \chi_i\right)
    \end{aligned}
    \nonumber
\end{equation}
where $\mathcal{A}_{ij}=\{(u_{i0},...,u_{iJ_i})\in\mathbb{R}^{J_i+1}\mid u_{ij}\geq u_{ik},\forall k\}$.


\section{The Canonical Model}
\begin{definition}[Canonical Model: Independence of Irrelevant Alternatives (IIA)]
    Discrete choice demand models are frequently formulated using a parametric random utility specification such as
    \begin{equation}
        \begin{aligned}
            u_{ijt}=x_{jt}\beta_{it}-\alpha_{it}p_{jt}+\xi_{jt}+\epsilon_{ijt}
        \end{aligned}
        \nonumber
    \end{equation}
    for $j>0$, with $u_{i0t}=\epsilon_{i0t}$.
\end{definition}

The notion of a “market” $t$ allows a precise characterization of the endogeneity problems inherent to demand estimation (In practice, markets are typically defined by natural combinations of time and geography). Let $\mathcal{J}_t$ denote the set of products (inside goods) available to consumers in market $t$, and let $J_t=|\mathcal{J}_t|$.

Let $x_t=(x_{1t},...,x_{J_t,t}), p_t=(p_{1t},...,p_{J_t,t}), \xi_t=(\xi_{1t},..., \xi_{J_t,t})$, and $\chi_t=(x_t,p_t,\xi_t)$.

\begin{enumerate}
    \item $p_{jt}$ represents the price of good $j$ in market $t$, while $x_{jt}\in \mathbb{R}^K$ represents other observable characteristics of good $j$ in the market.
    \item $\xi_{jt}$ is \textit{ a demand shock}, an unobserved factor associated with good $j$ and market $t$.
    \subitem $\circ$ ($\xi_{jt}$ can represent any combination of latent taste variation and latent product characteristics common to consumers in market $t$. For example, a high value of $\xi_{jt}$ may simply indicate that consumers in market $t$ have a high mean taste for good $j$.)
    \subitem $\circ$ ($\xi_{jt}$ is correlated with $p_{jt}$ and $x_{jt}$ by the endogeneity of prices and additional characteristics.)
    \subitem $\circ$ ($\xi_{jt}$ is not a characteristic, i.e., $\mathbb{E}[\xi_{jt}\mid x_{jt}]=0$.)
    \item $\epsilon_{ijt}$ is the \textit{utility shock}. It is most often specified as an i.i.d. draw from a standard type-1 extreme value distribution, yielding a \textit{mixed multinomial logit model}.
    \subitem $\circ$ Choice probabilities in the population reflect a mixture of the choice probabilities conditional on each possible combination of ($\alpha_{it},\beta_{it}$). In this case, the choice probabilities in the population (i.e., the market shares) are given by
    \begin{equation}
        \begin{aligned}
            s_{jt}=\int \frac{\exp(x_{jt}\beta_{it}-\alpha_{it}p_{jt}+\xi_{jt})}{\sum_{k=0}^{J_t}\exp(x_{kt}\beta_{it}-\alpha_{it}p_{kt}+\xi_{kt})}d F(\alpha_{it},\beta_{it};t)
        \end{aligned}
        \label{eq:mixed_multinomial_logit}
    \end{equation}
    where the latent taste parameters $\alpha_{it}$ and $\beta_{it}$ are often referred to as ``random coefficients,'' and $F(\cdot;t)$ denotes their joint distribution in market $t$.
    \subitem $\circ$ Alternatively, a normal distribution will yield a mixed multinomial probit.
    \item The joint distribution $F(\cdot;t)$ is commonly specified as follows.
    \begin{enumerate}
        \item Each component $k$ of the random coefficient vector $\beta_{it}$ typically specified takes the form
        \begin{equation}
            \begin{aligned}
                \beta_{it}^{(k)}=\beta_{0}^{(k)}+\beta_{v}^{(k)}v_{it}^{(k)}+\sum_{l=1}^L\beta_{d}^{(l,k)}d_{ilt}
            \end{aligned}
            \label{eq:beta_it}
        \end{equation}
        Remind that the $\beta_{it}^{(k)}$ contributes as $x_{jt}^{(k)}\beta_{it}^{(k)}$.
        \begin{enumerate}
            \item The $\beta_{0}^{(k)}$ is a parameter shifting \underline{all} consumers' tastes for additional characteristics $x_{jt}^{(k)}$.
            \item Each $d_{ilt}$ represents a \textit{characteristic} (e.g., demographic measure) of individual $i$; the $\beta_{d}^{(l,k)}$ governs the extent of variation in tastes for $x_{jt}^{(k)}$ with different values of $d_{ilt}$.
            \item Each $v_{it}^{(k)}$ represents a \textit{taste shock}, which is a random variable with a pre-specified distribution (e.g., a standard normal); the $\beta_{v}^{(k)}$ governs the extent of variation in tastes for $x_{jt}^{(k)}$ with different values of $v_{it}^{(k)}$.
        \end{enumerate}
        \item A typical specification of $\alpha_{it}$ takes the form
        \begin{equation}
            \begin{aligned}
                \ln(\alpha_{it})=\alpha_0+\alpha_y y_{it}+\alpha_v v_{it}^{(0)}
            \end{aligned}
            \label{eq:alpha_it}
        \end{equation}
        where $y_{it}$ represents consumer-specific measures such as income that are posited to affect price sensitivity. The variables included in $y_{it}$ might overlap partially or entirely with $d_{it}$.
    \end{enumerate}
\end{enumerate}



\section{Market-Level Data}
We typically observe key data at the market level:
\begin{enumerate}
    \item $J_t$: the number of goods available to consumers in each market $t$;
    \item $p_t,x_t$: prices and additional characteristics of goods in each market $t$;
    \item $\tilde{s}_{jt}$: observed market shares, typically measured by $\tilde{s}_{jt}:=\frac{\textnormal{total quantity of good $j$ sold in market $t$}}{\textnormal{total number of consumers in market $t$}}$.
    \item \textit{Distributions of $(d_{it},y_{it})$}: distribution of consumer characteristics in each market.
    \item Additional variables $w_t$ that might serve as appropriate instruments.
\end{enumerate}



\section{\cite{berry1994estimating}: IV-based estimation with unobserved demand shock}
Consider the case without random coefficients, i.e., $(\alpha,\beta)$ are common across all $i$:
\begin{equation}
    \begin{aligned}
        u_{ijt}=\underbrace{x_{jt}\beta-\alpha p_{jt}+\xi_{jt}}_{:=\delta_{jt}}+\epsilon_{ijt}
    \end{aligned}
    \nonumber
\end{equation}
In MNL case, the choice probabilities in the population are given by
\begin{equation}
    \begin{aligned}
        s_{jt}=\frac{\exp(x_{jt}\beta-\alpha p_{jt}+\xi_{jt})}{1+\sum_{k=1}^{J_t}\exp(x_{kt}\beta-\alpha p_{kt}+\xi_{kt})}=\frac{\exp(\delta_{jt})}{1+\sum_{k=1}^{J_t}\exp(\delta_{kt})}:=\hat{s}_{jt}(\delta_{1t},...,\delta_{J_tt})
    \end{aligned}
    \label{eq:s_jt}
\end{equation}
for $j=1,...,J_t$ and $s_{0t}=\frac{1}{1+\sum_{k=1}^{J_t}\exp(x_{kt}\beta-\alpha p_{kt}+\xi_{kt})}$.

\begin{note}
    We cannot do \textbf{nonlinear least squares, i.e.}
    \begin{equation}
        \begin{aligned}
            \min_{\alpha,\beta} \sum_{j=1}^{J_t}\left(\tilde{s}_{jt}-\frac{\exp(x_{jt}\beta-\alpha p_{jt}+\xi_{jt})}{1+\sum_{k=1}^{J_t}\exp(x_{kt}\beta-\alpha p_{kt}+\xi_{kt})}\right)^2
        \end{aligned}
        \nonumber
    \end{equation}
    because we need to know the $x_{jt}$ in order to estimate $\alpha$ and $\beta$.
\end{note}

\subsection{Inversion}
\cite{berry1994estimating} suggests an IV-based estimation with unobserved demand shock:

Assume there exist instruments $z_{jt}$ such that $\mathbb{E}[\xi_{jt}z_{jt}]=0$. The corresponding moment condition is
\begin{equation}
    \begin{aligned}
        \frac{1}{J_t}\sum_{j=1}^{J_t}\xi_{jt}z_{jt}=\frac{1}{J_t}\sum_{j=1}^{J_t}\left(\delta_{jt}-x_{jt}\beta+\alpha p_{jt}\right)z_{jt} \stackrel{J \rightarrow \infty}{\longrightarrow} 0
    \end{aligned}
    \label{eq:iv_moment}
    \tag{Sample Moment}
\end{equation}
which converges to zero at the true value of $\alpha$ and $\beta$. We want to estimate $\alpha$ and $\beta$ by minimizing the sample moment. However, we do not know $\delta_{jt}$.
\begin{definition}
    \cite{berry1994estimating} suggests a two-step approach
    \begin{enumerate}
        \item \textbf{Inversion}: By equating the data $\tilde{s}_{jt}$ and the choice probabilities $\hat{s}_{jt}(\delta_{1t},...,\delta_{Jt})$, we have a system of $J$ nonlinear equations:
        \begin{equation}
            \begin{aligned}
                \left\{\begin{matrix}
                    \tilde{s}_{1t}&=\hat{s}_{1t}(\delta_{1t},...,\delta_{J_tt})\\
                    \vdots&\vdots\\
                    \tilde{s}_{J_tt}&=\hat{s}_{J_tt}(\delta_{1t},...,\delta_{J_tt})\\
                \end{matrix}\right.
            \end{aligned}
            \nonumber
        \end{equation}
        Then, we can ``inverse'' this system of equations to solve for $\delta_{1t},...,\delta_{J_tt}$ as a function of $\tilde{s}_{1t},...,\tilde{s}_{J_tt}$:
        \begin{equation}
            \begin{aligned}
                \hat{\delta}_{jt}:=\delta_{jt}(\tilde{s}_{1t},...,\tilde{s}_{J_tt})
            \end{aligned}
            \label{eq:inversion}
        \end{equation}
        \item \textbf{IV Estimation}: Now, by going back to definition of $\delta_{jt}$, we have
        \begin{equation}
            \begin{aligned}
                \left\{\begin{matrix}
                    \delta_{1t}:&=x_{1t}\beta-\alpha p_{1t}+\xi_{1t}\\
                    \vdots&\vdots\\
                    \delta_{J_tt}:&=x_{J_tt}\beta-\alpha p_{J_tt}+\xi_{J_tt}
                \end{matrix}\right.
            \end{aligned}
            \nonumber
        \end{equation}
        Now, using estimated $\hat{\delta}_{jt}$ to calculate sample moment, and find $\alpha$ and $\beta$ by minimizing the sample moment \eqref{eq:iv_moment}:
        \begin{equation}
            \begin{aligned}
                \min_{\alpha,\beta}\frac{1}{J_t}\sum_{j=1}^{J_t}\left(\hat{\delta}_{jt}-x_{jt}\beta+\alpha p_{jt}\right)z_{jt}
            \end{aligned}
            \nonumber
        \end{equation}
        (If $\delta_{jt}$ is linear, we can use linear IV estimation.)
    \end{enumerate}
\end{definition}
\begin{example}[ (MNL Case)]
    Consider the MNL case in \eqref{eq:s_jt}:
    Taking logs
    \begin{equation}
        \begin{aligned}
            \ln s_{0t}&=-\log\left(1+\sum_{k=1}^{J_t}\exp(\delta_{kt})\right)\\
            \ln s_{jt}&=\delta_{jt}-\log\left(1+\sum_{k=1}^{J_t}\exp(\delta_{kt})\right)
        \end{aligned}
        \nonumber
    \end{equation}
    Then, the equation system gives:
    \begin{equation}
        \begin{aligned}
            \underbrace{\ln \tilde{s}_{jt}-\ln \tilde{s}_{0t}}_\text{Data}&=\delta_{jt}:= x_{jt}\beta-\alpha p_{jt}+\xi_{jt}
        \end{aligned}
        \nonumber
    \end{equation}
    There is one to one mapping between $s_{jt}$ and $\xi_{jt}$.
    \begin{enumerate}
        \item \textbf{Pro:} Now we can do \textit{IV regression} of $\ln \tilde{s}_{jt}-\ln \tilde{s}_{0t}$ on $x_{jt}\beta-\alpha p_{jt}+\xi_{jt}$ with IV $z_{jt}$. 2SLS: regress $p_{jt}$ on $z_{jt}$ first and then regress $\ln \tilde{s}_{jt}-\ln \tilde{s}_{0t}$ on $x_{jt}$ and $\hat{p_{jt}}(z_{jt})$.
        \item \textbf{Con:} we need aggregate data and shares \textit{without sampling error (variance)}. Note that $\ln(s_1+\epsilon)-\ln(s_2+\epsilon)\neq \ln(s_1)-\ln(s_2)$.
    \end{enumerate}
\end{example}

\subsection{Supply Side Recover}
In previous section, we have estimated the demand function for brand $j$, which is denoted by
\begin{equation}
    \begin{aligned}
        D^j\left(\vec{x},\vec{p},\vec{\xi}\right)
    \end{aligned}
    \nonumber
\end{equation}
where $\vec{x}:=x_t=(x_{1t},...,x_{J_t,t}), \vec{p}:=p_t=(p_{1t},...,p_{J_t,t}), \vec{\xi}:=\xi_t=(\xi_{1t},..., \xi_{J_t,t})$. We omit the $t$ in the notation. Now, we specify the costs of producing brand $j$ as
\begin{equation}
    \begin{aligned}
        C^j\left(q_j,w_j,\omega_j\right)
    \end{aligned}
    \nonumber
\end{equation}
where $q_j$ is total production of brand $j$, $w_j$ are observed cost components associated with brand $j$ (e.g. could be characteristics of brand j), $\omega_j$ are unobserved cost components (another structural error)

Then profits for brand $j$ are:
\begin{equation}
    \begin{aligned}
        \Pi_j=D^j\left(\vec{x},\vec{p},\vec{\xi}\right)p_j-C^j\left(D^j\left(\vec{x},\vec{p},\vec{\xi}\right),w_j,\omega_j\right)
    \end{aligned}
    \nonumber
\end{equation}
For multiproduct firm: assume that firm $k$ produces all brands $j \in \mathcal{K}$. Then its profits are
\begin{equation}
    \begin{aligned}
        \tilde{\Pi}_k=\sum_{j \in \mathcal{K}}\Pi_j
    \end{aligned}
    \nonumber
\end{equation}

The most common assumption is Bertrand (price) competition. Under price competition, equilibrium prices are characterized by $J$ equations
\begin{equation}
    \begin{aligned}
        \frac{\partial \tilde{\Pi}_k}{\partial p_j}=D^j+\sum_{j'\in \mathcal{K}}\frac{\partial D^{j'}}{\partial p_j}\left(p_j-\frac{\partial C^{j'}}{\partial q_{j'}}\right)=0,\ \forall j\in \mathcal{K},\forall k
    \end{aligned}
    \nonumber
\end{equation}
where $\frac{\partial C^{j'}}{\partial q_{j'}}$ is the marginal cost function.

Since we have already estimated the demand side, all $D^j$ and $\frac{\partial D^{j'}}{\partial p_j}$ can be calculated. Hence, we can solve the marginal costs $\frac{\partial C^{j}}{\partial q_{j}}$ as
\begin{equation}
    \begin{aligned}
        \left(\frac{\partial C^{1}}{\partial q_{1}},...,\frac{\partial C^{J}}{\partial q_{J}}\right)=\vec{p}+(\Delta D)^{-1}\vec{D}
    \end{aligned}
    \nonumber
\end{equation}
where $\vec{D}:=\left(D_1,...,D_J\right)$ and $\Delta D$ is a $J\times J$ matrix where
\begin{equation}
    \begin{aligned}
        \Delta D_{(i,j)}=
        \left\{\begin{matrix}
            \frac{\partial D^{i}}{\partial p_j}& \textnormal{ if models $(i,j)$ produced by the same firm}\\
            0& \textnormal{ otherwise}
        \end{matrix}\right.
    \end{aligned}
    \nonumber
\end{equation}





\section{\cite{berry1995automobile}: Estimation using random-coefficients logit model}
Now we consider the case of the random-coefficients logit model.
\begin{equation}
    \begin{aligned}
        u_{ijt}=x_{jt}\beta_{it}-\alpha_{it}p_{jt}+\xi_{jt}+\epsilon_{ijt}
    \end{aligned}
    \nonumber
\end{equation}
where $(\alpha_{it},\beta_{it})$ are allowed to vary across $i$.


We follow \cite{berry1995automobile} in assuming that each $\epsilon_{ijt}$ is an i.i.d. draw from a standard type-1 extreme value (Gumbel) distribution. The most common assumption is that these random variables are jointly normally distributed.
\begin{equation}
    \begin{aligned}
        (\alpha_{it},\beta_{it})'\sim N\left((\bar{\alpha},\bar{\beta})',\Sigma\right)
    \end{aligned}
    \nonumber
\end{equation}
where $\bar{\alpha}$ and $\bar{\beta}$ are the average of $\alpha_{it}$ and $\beta_{it}$ that represent \underline{all} consumers' tastes. In this case, define $\delta_{jt}:=x_{jt}\bar{\beta}-\bar{\alpha}p_{jt}+\xi_{jt}$. The parameters to be estimated are
\begin{equation}
    \begin{aligned}
        \theta:=(\bar{\alpha},\bar{\beta},\Sigma)
    \end{aligned}
    \nonumber
\end{equation}
The choice probabilities take the MNL form:
\begin{equation}
    \begin{aligned}
        s_{jt}&=\int \frac{\exp(x_{jt}\beta_{it}-\alpha_{it}p_{jt}+\xi_{jt})}{1+\sum_{k=1}^{J_t}\exp(x_{kt}\beta_{it}-\alpha_{it}p_{kt}+\xi_{kt})}d F(\alpha_{it},\beta_{it};t)\\
        &=\int \frac{\exp(\delta_{jt}+x_{jt}(\beta_{it}-\bar{\beta})-(\alpha_{it}-\bar{\alpha})p_{jt})}{1+\sum_{k=1}^{J_t}\exp(\delta_{kt}+x_{kt}(\beta_{it}-\bar{\beta})-(\alpha_{it}-\bar{\alpha})p_{kt})}d F(\alpha_{it},\beta_{it};t)\\
        &:=\hat{s}_{jt}^{RC}\left(\delta_{1t},...,\delta_{J_tt};\Sigma\right)
    \end{aligned}
    \nonumber
\end{equation}
Note that the distributions of $\alpha_{it}-\bar{\alpha}$ and $\beta_{it}-\bar{\beta}$ are normal distribution with mean $0$ and covariance matrix $\Sigma$. So, it can be written as a function that only depends on $\Sigma$.

In this case, the inversion step described before will not work, because the $J_t$ equations matching observed to predicted shares have more than $J_t$ unknowns.

\cite{berry1995automobile} proposed a generalized method of moments (GMM) estimation approach that can be sketched as follows:
\begin{enumerate}
    \item Take a trial value of the parameters $\theta$;
    \item Then, for each market $t$, the inversion step described before can be used. We ``invert'' the demand model at the observed market shares $\tilde{s}_{jt}$ to find $\hat{\delta}_{jt}(\Sigma):=\delta_{jt}(\tilde{s}_{1t},...,\tilde{s}_{J_tt};\Sigma)$ as \eqref{eq:inversion}. The corresponding unobserved characteristics are $$\xi_{jt}(\theta):=\hat{\delta}_{jt}(\Sigma)-x_{jt}\bar{\beta}+\bar{\alpha}p_{jt}$$
    \item Evaluate the trial value $\theta$ using a GMM criterion function based on moment conditions \eqref{eq:iv_moment} of the form
    \begin{equation}
        \begin{aligned}
            \min_{\theta}\frac{1}{N}\sum_{\forall j,t}\xi_{jt}(\theta)z_{jt}
        \end{aligned}
        \nonumber
    \end{equation}
    where $N=\sum_{t=1}^T J_t$ and $z_{jt}\supset x_{jt}$ is a vector of  appropriate instrumental variables;
    \item Repeat steps 1 and 2 until convergence.
\end{enumerate}


\section{\cite{nevo2001measuring}: Measuring Market Power}
In this paper, he considers different models of supply conduct.  Demand parameters are estimated and used to compute the price-cost margins (PCM) implied by different models of conduct.

\subsection{Supply}
Suppose there are $F$ firms. Among all products $\mathcal{J}=\{1,...,J\}$, the subset of products produced by a firm $f$ is denoted by $\mathcal{F}_f$. The profits of the firm $f$ are
\begin{equation}
    \begin{aligned}
        \Pi_f=\sum_{j\in \mathcal{F}_f}(p-mc_j)Ms_j(p)-C_f
    \end{aligned}
    \nonumber
\end{equation}
where $mc_j$ is the marginal cost, $M$ is the size of the market, $s_j(p)$ is the market share of brand $j$ at price $p$, and $C_f$ is the fixed cost of production.

Assuming the existence of pure-strategy Bertrand-Nash equilibrium in prices, and that the prices that support it are strictly positive. The price $p_j$ of product $j$ produced by firm $f$ must satisfy the FOC,
\begin{equation}
    \begin{aligned}
        s_j(p)+\sum_{r\in\mathcal{F}_f}(p_r-mc_r)\frac{\partial s_r(p)}{\partial p_j}=0
    \end{aligned}
    \label{Nevo_2021_FOC}
\end{equation}
By defining $S_{jr}:=-\frac{\partial s_r}{\partial p_j}$ and a $J\times J$ matrix $\Omega$ such that $\Omega_{jr}:=\Omega_{jr}^*S_{jr}$ where $$\Omega_{jr}^*=\left\{\begin{matrix}
    1,& \textnormal{ if }\exists f:\{r,j\}\subset \mathcal{F}_f,\\
    0,& \textnormal{ otherwise}.
\end{matrix}\right.$$
In vector notation, the set of equations of first-order conditions \eqref{Nevo_2021_FOC} can be written as
\begin{equation}
    \begin{aligned}
        &s(p)-\Omega(p-mc)=0\\
        \Leftrightarrow\ &\underbrace{p-mc}_\textnormal{PCM}=\Omega^{-1}s(p)
    \end{aligned}
    \nonumber
\end{equation}
where $s(\cdot),p,$ and $mc$ are $J\times 1$ vectors.

In this paper, there are three  hypothetical industry conduct models and the PCM in all of them can be estimated by defining $\mathcal{F}_f$ and $\Omega^*$.
\begin{enumerate}
    \item Single-product firms: price of each brand is set by a profit-maximizing strategy for that brand.\\
    $\circ$: In this case, the PCM arise only from \textit{product differentiation}.
    \item Current structure: multi-product firms set prices of all their products jointly.\\
    $\circ$: In this case, the PCM arise from \textit{product differentiation} and \textit{portfolio effect}.
    \item Monopoly / Price collusion: all prices of products are set jointly.\\
    $\circ$: In this case, the PCM arise from \textit{product differentiation}, \textit{portfolio effect}, and \textit{price collusion}.
\end{enumerate}

\subsection{Demand}
Suppose we observe $t=1,...,T$ markets, each with $i=1,...,I_t$ consumers. (A market is defined as a city-quarter combination). The conditional indirect utility of consumer $i$ from product $j$ at market $t$ is
\begin{equation}
    \begin{aligned}
        u_{ijt}=x_j\beta_i^*-\alpha_i^*p_{jt}+\xi_{j}+\Delta\xi_{jt}+\epsilon_{ijt},\\ \forall i=1,...,I_t, j=1,...,J_t, t=1,...,T,
    \end{aligned}
    \label{Nevo_2021_(2)}
\end{equation}
where $x_j$ is a K-dimensional (row) vector of observable product characteristics,
$p_{jt}$ is the price of product $j$ in market $t$, $\xi_j$ is the national mean valuation of the unobserved (by the econometricians) product characteristics, $\Delta\xi_{jt}$ is a city-quarter specific deviation from this mean, and $\epsilon_{ijt}$ is a mean-zero stochastic term. Finally, $(\alpha_i^*,\beta_i^*)$ are $K + 1$ individual-specific \textit{coefficients}.

The distribution of consumers' taste parameters for the characteristics is modeled as multivariate normal (conditional on demographics) with a mean that is a function of demographic variables and parameters to be estimated, and a variance-covariance matrix to be estimated. Let
\begin{equation}
    \begin{aligned}
        \begin{pmatrix}
            \alpha_i^*\\
            \beta_i^*
        \end{pmatrix}
        =
        \begin{pmatrix}
            \alpha\\
            \beta
        \end{pmatrix}
        +\Pi D_i + \Sigma v_i,\ v_i\sim \mathcal{N}(0,I_{K+1})
    \end{aligned}
    \label{Nevo_2021_(3)}
\end{equation}
where $K$ is the dimension of the observed characteristics vector, $D_i$ is a $d \times 1$ vector of demographic variables, $\Pi$ is a $(K+1)\times d$ matrix of \textit{coefficients} that measure how the taste characteristics vary with demographics, and $\Sigma$ is a scaling matrix.

The indirect utility from this outside option is
\begin{equation}
    \begin{aligned}
        u_{i0t}=\xi_0+\pi_0 D_i+\sigma_0 v_{i0}+\epsilon_{i0t}
    \end{aligned}
    \nonumber
\end{equation}
where $\xi_0$ is normalized to zero.

Let $\theta=(\theta_1,\theta_2)$ be a vector containing all parameters of the model. The vector $\theta_1=(\alpha,\beta)$ contains the linear parameters and the vector $\theta_2=(\textnormal{vec}(\Pi),\textnormal{vec}(\Sigma))$ the nonlinear parameters.

Combining \eqref{Nevo_2021_(2)} and \eqref{Nevo_2021_(3)}, we obtain
\begin{equation}
    \begin{aligned}
        u_{ijt}=&\delta_{jt}\left(x_j,p_{jt},\xi_j,\Delta\xi_{jt};\theta_1\right)+\mu_{ijt}\left(x_j,p_{jt},v_i,D_i;\theta_2\right)+\epsilon_{ijt},\\
        \textnormal{where }&\delta_{jt}:=x_j\beta - \alpha p_{jt} + \xi_j +\Delta\xi_{jt},\\
        &\mu_{ijt}:=
        \begin{bmatrix}
            p_{jt}\\
            x_j
        \end{bmatrix}\cdot \left(\Pi D_i + \Sigma v_i\right)
    \end{aligned}
    \label{Nevo_2021_(4)}
\end{equation}
where $D_i,v_i,\epsilon_it$ are assumed to follow some distributions.

Given $x:=(x_1,...,x_{J_t})^T\in \mathbb{R}^{J_t\times K}, p_{.t}:=(p_1,...,p_{J_t})^T\in \mathbb{R}^{J_t}$, and $\delta_{.t}:=(\delta_1,...,\delta_{J_t})^T\in \mathbb{R}^{J_t}$, the set of $(D_i,v_i,\epsilon_i)$ is
\begin{equation}
    \begin{aligned}
        A_{jt}\left(x,p_{.t},\delta_{.t};\theta_2\right):=\left\{(D_i,v_i,\epsilon_{it})\mid u_{ijt}\geq u_{ilt},\forall l=0,1,...,J_t\right\}
    \end{aligned}
    \nonumber
\end{equation}
Then, the market share of the $j^{th}$ product is give by
\begin{equation}
    \begin{aligned}
        s_{jt}\left(x,p_{.t},\delta_{.t};\theta_2\right)=\int_{A_{jt}}d P^*(D,v,\epsilon)
    \end{aligned}
    \label{Nevo_2021_(5)}
\end{equation}
where $P^*(\cdot)$ denotes population distribution functions.


\subsection{Estimation}
Let $Z=[z_1,...,z_M]$ be a set of IV such that $\mathbb{E}[Z^T\omega(\theta^*)]=0$, where $\omega$ is an \textit{error} term that is a function of the model parameters and $\theta^*$ denotes the true values of model parameters. The GMM estimate is given by
\begin{equation}
    \begin{aligned}
        \hat{\theta}=\argmin_{\theta}\omega(\theta)^TZA^{-1}Z^T\omega(\theta)
    \end{aligned}
    \label{Nevo_2021_(6)}
\end{equation}
where $A$ is a constant estimate of $\mathbb{E}[Z^T\omega\omega^TZ]$.

Following \cite{berry1994estimating}, the error term $\omega$ is defined as the unobserved characteristics, $\xi_j+\Delta\xi_{jt}$. The error term can be obtained by the inversion of the equation system:
\begin{equation}
    \begin{aligned}
        s_{jt}\left(x,p_{.t},\delta_{.t};\theta_2\right)=S_{.t}
    \end{aligned}
    \label{Nevo_2021_(7)}
\end{equation}
where $S_{.t}$ are the observed market shares. By its inverse function, we can compute $\delta_{jt}$ as a function of $S_{.t}$:
\begin{equation}
    \begin{aligned}
        \delta_{jt}(x,p_{.t},S_{.t};\theta_2)
    \end{aligned}
    \nonumber
\end{equation}
Then, the error term is defined as
\begin{equation}
    \begin{aligned}
        \omega_{jt}=\delta_{jt}(x,p_{.t},S_{.t};\theta_2)-(x_j\beta+\alpha p_{jt})
    \end{aligned}
    \nonumber
\end{equation}
And the $A$ in \eqref{Nevo_2021_(6)} is computed by the two-step procedure:
\begin{enumerate}
    \item Set the weight matrix to $Z^T Z$ and compute the initial estimate of the parameters, denoted by $\theta^{(1)}$:
    \begin{equation}
        \begin{aligned}
            \theta^{(1)}=\argmin_{\theta} \omega(\theta)^T\omega(\theta)
        \end{aligned}
        \nonumber
    \end{equation}
    \item Use the initial estimate to re-compute the weight matrix, i.e., $A=\frac{1}{n}\sum_{i=1}^n \omega(\theta^{(1)})\omega(\theta^{(1)})^TZ^TZ$, where
\end{enumerate}



























\bibliography{ref}




\end{document}